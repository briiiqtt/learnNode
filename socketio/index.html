<html>

<head>
    <meta charset="utf-8">
    <title>Socket</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <div>
        <h1 id="banner">default namespace</h1>
        <ul id="messages1"></ul>
        nickname: <input id="nickname"><br>

        <button class="confirmNickname">confirm nickname</button>

        <div id="hidedDiv" style="display: none;">
            <div class="roomBtns">
                <button class="roomBtn" data-num="1">room1</button>
                <button class="roomBtn" data-num="2">room2</button>
                <button class="roomBtn" data-num="3">room3</button>
            </div>
            <br>
            <input id="chat">
        </div>
        <div>
            <ul id="chats"></ul>
        </div>
    </div>


</body>

<script>
    const socket = io();
    socket.on('msgToRoom', (d) => {
        let li = document.createElement('li');
        li.innerText = d;
        document.getElementById('chats').appendChild(li);
    })
</script>


<script>

    let chat = document.getElementById('chat');


    function Chatter() {
        this.curRoom = null;
        this.nickname = null;

        this.joinRoom = function (e) {

            if (this.curRoom) {
                this.leaveRoom();
            }

            let roomNum = e.target.getAttribute('data-num');
            this.curRoom = roomNum;
            document.getElementById('banner').innerHTML = 'ROOM' + this.curRoom;

            socket.emit('joinRoom', this.curRoom, nickname.value);

        }

        this.leaveRoom = function () {
            socket.emit('leaveRoom', this.curRoom, this.nickname);
            this.curRoom = null;
        }

        this.setNickname = function () {
            let nickInput = document.getElementById('nickname');
            if (!nickInput.value) {
                alert('닉네임입력하세ㅛㅇ')
                return false;
            }
            nickInput.readOnly = true;
            this.nickname = nickInput.value;
            document.getElementById('hidedDiv').style.display = 'block';
        }
    }

    let chatter = new Chatter();

    document.addEventListener('click', (e) => {
        if (e.target.tagName !== 'BUTTON') return false;

        if (e.target.className === 'roomBtn') {
            chatter.joinRoom(e);
        }

        if (e.target.className === 'confirmNickname') {
            chatter.setNickname();
        }

    })

    chat.addEventListener('keydown', (e) => {
        if (e.keyCode !== 13) return false;
        socket.emit('msgToServer', chatter.curRoom, chatter.nickname, chat.value);
        chat.value = '';
    })



</script>


</html>